{"ast":null,"code":"var _jsxFileName = \"/home/dev/Code/dex-ui/src/components/Orderbook.jsx\";\nimport { Col, Row } from 'antd';\nimport React, { useRef, useEffect, useState } from 'react';\nimport styled, { css } from 'styled-components';\nimport { useMarket, useOrderbook, useMarkPrice } from '../utils/markets';\nimport { isEqual, getDecimalCount } from '../utils/utils';\nimport { useInterval } from '../utils/useInterval';\nimport FloatingElement from './layout/FloatingElement';\nimport usePrevious from '../utils/usePrevious';\nimport { ArrowUpOutlined, ArrowDownOutlined } from '@ant-design/icons';\nconst Title = styled.div`\n  color: rgba(255, 255, 255, 1);\n`;\nconst SizeTitle = styled(Row)`\n  padding: 16px 0 12px;\n  color: #434a59;\n`;\nconst MarkPriceTitle = styled(Row)`\n  padding: 15px 0 12px;\n  font-weight: 700;\n`;\nconst Line = styled.div`\n  text-align: right;\n  float: right;\n  height: 100%;\n  ${props => props['data-width'] && css`\n      width: ${props['data-width']};\n    `}\n  ${props => props['data-bgcolor'] && css`\n      background-color: ${props['data-bgcolor']};\n    `}\n`;\nconst Price = styled.div`\n  position: absolute;\n  right: 5px;\n  color: white;\n`;\nexport default function Orderbook({\n  smallScreen,\n  depth = 7,\n  onPrice,\n  onSize\n}) {\n  const markPrice = useMarkPrice();\n  const [orderbook] = useOrderbook();\n  const {\n    baseCurrency,\n    quoteCurrency\n  } = useMarket();\n  const currentOrderbookData = useRef(null);\n  const lastOrderbookData = useRef(null);\n  const [orderbookData, setOrderbookData] = useState(null);\n  useInterval(() => {\n    if (!currentOrderbookData.current || JSON.stringify(currentOrderbookData.current) !== JSON.stringify(lastOrderbookData.current)) {\n      let bids = (orderbook === null || orderbook === void 0 ? void 0 : orderbook.bids) || [];\n      let asks = (orderbook === null || orderbook === void 0 ? void 0 : orderbook.asks) || [];\n\n      let sum = (total, [, size], index) => index < depth ? total + size : total;\n\n      let totalSize = bids.reduce(sum, 0) + asks.reduce(sum, 0);\n      let bidsToDisplay = getCumulativeOrderbookSide(bids, totalSize, false);\n      let asksToDisplay = getCumulativeOrderbookSide(asks, totalSize, true);\n      currentOrderbookData.current = {\n        bids: orderbook === null || orderbook === void 0 ? void 0 : orderbook.bids,\n        asks: orderbook === null || orderbook === void 0 ? void 0 : orderbook.asks\n      };\n      setOrderbookData({\n        bids: bidsToDisplay,\n        asks: asksToDisplay\n      });\n    }\n  }, 250);\n  useEffect(() => {\n    lastOrderbookData.current = {\n      bids: orderbook === null || orderbook === void 0 ? void 0 : orderbook.bids,\n      asks: orderbook === null || orderbook === void 0 ? void 0 : orderbook.asks\n    };\n  }, [orderbook]);\n\n  function getCumulativeOrderbookSide(orders, totalSize, backwards = false) {\n    let cumulative = orders.slice(0, depth).reduce((cumulative, [price, size], i) => {\n      var _cumulative;\n\n      const cumulativeSize = (((_cumulative = cumulative[i - 1]) === null || _cumulative === void 0 ? void 0 : _cumulative.cumulativeSize) || 0) + size;\n      cumulative.push({\n        price,\n        size,\n        cumulativeSize,\n        sizePercent: Math.round(cumulativeSize / (totalSize || 1) * 100)\n      });\n      return cumulative;\n    }, []);\n\n    if (backwards) {\n      cumulative = cumulative.reverse();\n    }\n\n    return cumulative;\n  }\n\n  return /*#__PURE__*/React.createElement(FloatingElement, {\n    style: { ...(smallScreen ? {\n        flex: 1\n      } : {\n        height: '500px',\n        overflow: 'hidden'\n      }),\n      height: 540\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Title, {\n    style: {\n      borderTop: '1px solid #1C274F',\n      borderBottom: '1px solid #1C274F',\n      padding: '12px 0 12px 16px',\n      color: 'rgba(241, 241, 242, 0.75)',\n      fontSize: 14\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }\n  }, \"Order book\"), /*#__PURE__*/React.createElement(SizeTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    style: {\n      textAlign: 'right',\n      color: 'rgba(241, 241, 242, 0.5)',\n      fontSize: 12\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 9\n    }\n  }, \"Size (\", baseCurrency, \")\"), /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    style: {\n      textAlign: 'right',\n      paddingRight: 20,\n      color: 'rgba(241, 241, 242, 0.5)',\n      fontSize: 12\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 9\n    }\n  }, \"Price (\", quoteCurrency, \")\")), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      paddingBottom: 16\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 7\n    }\n  }, orderbookData === null || orderbookData === void 0 ? void 0 : orderbookData.asks.map(({\n    price,\n    size,\n    sizePercent\n  }) => /*#__PURE__*/React.createElement(OrderbookRow, {\n    key: price + '',\n    price: price,\n    size: size,\n    side: 'sell',\n    sizePercent: sizePercent,\n    onPriceClick: () => onPrice(price),\n    onSizeClick: () => onSize(size),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(MarkPriceComponent, {\n    markPrice: markPrice,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(SizeTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    style: {\n      textAlign: 'right',\n      color: 'rgba(241, 241, 242, 0.5)',\n      fontSize: 12\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 9\n    }\n  }, \"Size (\", baseCurrency, \")\"), /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    style: {\n      textAlign: 'right',\n      paddingRight: 20,\n      color: 'rgba(241, 241, 242, 0.5)',\n      fontSize: 12\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 9\n    }\n  }, \"Price (\", quoteCurrency, \")\")), orderbookData === null || orderbookData === void 0 ? void 0 : orderbookData.bids.map(({\n    price,\n    size,\n    sizePercent\n  }) => /*#__PURE__*/React.createElement(OrderbookRow, {\n    key: price + '',\n    price: price,\n    size: size,\n    side: 'buy',\n    sizePercent: sizePercent,\n    onPriceClick: () => onPrice(price),\n    onSizeClick: () => onSize(size),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 9\n    }\n  })));\n}\nconst OrderbookRow = React.memo(({\n  side,\n  price,\n  size,\n  sizePercent,\n  onSizeClick,\n  onPriceClick\n}) => {\n  const element = useRef();\n  const {\n    market\n  } = useMarket();\n  useEffect(() => {\n    var _element$current, _element$current2;\n\n    // eslint-disable-next-line\n    !((_element$current = element.current) === null || _element$current === void 0 ? void 0 : _element$current.classList.contains('flash')) && ((_element$current2 = element.current) === null || _element$current2 === void 0 ? void 0 : _element$current2.classList.add('flash'));\n    const id = setTimeout(() => {\n      var _element$current3, _element$current4;\n\n      return ((_element$current3 = element.current) === null || _element$current3 === void 0 ? void 0 : _element$current3.classList.contains('flash')) && ((_element$current4 = element.current) === null || _element$current4 === void 0 ? void 0 : _element$current4.classList.remove('flash'));\n    }, 250);\n    return () => clearTimeout(id);\n  }, [price, size]);\n  let formattedSize = (market === null || market === void 0 ? void 0 : market.minOrderSize) && !isNaN(size) ? Number(size).toFixed(getDecimalCount(market.minOrderSize) + 1) : size;\n  let formattedPrice = (market === null || market === void 0 ? void 0 : market.tickSize) && !isNaN(price) ? Number(price).toFixed(getDecimalCount(market.tickSize) + 1) : price;\n  return /*#__PURE__*/React.createElement(Row, {\n    ref: element,\n    style: {\n      marginBottom: 3,\n      fontSize: 12\n    },\n    onClick: onSizeClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    style: {\n      textAlign: 'right'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 9\n    }\n  }, formattedSize), /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    style: {\n      textAlign: 'right'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Line, {\n    \"data-width\": sizePercent + '%',\n    \"data-bgcolor\": side === 'buy' ? 'rgba(65, 199, 122, 0.6)' : 'rgba(242, 60, 105, 0.6)',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Price, {\n    onClick: onPriceClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 11\n    }\n  }, formattedPrice)));\n}, (prevProps, nextProps) => isEqual(prevProps, nextProps, ['price', 'size', 'sizePercent']));\nconst MarkPriceComponent = React.memo(({\n  markPrice\n}) => {\n  const {\n    market\n  } = useMarket();\n  const previousMarkPrice = usePrevious(markPrice);\n  let markPriceColor = markPrice > previousMarkPrice ? '#41C77A' : markPrice < previousMarkPrice ? '#F23B69' : 'white';\n  let formattedMarkPrice = markPrice && (market === null || market === void 0 ? void 0 : market.tickSize) && markPrice.toFixed(getDecimalCount(market.tickSize));\n  return /*#__PURE__*/React.createElement(MarkPriceTitle, {\n    justify: \"center\",\n    style: {\n      borderTop: '1px solid #1C274F',\n      borderBottom: '1px solid #1C274F',\n      fontSize: 16\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    style: {\n      color: markPriceColor\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 9\n    }\n  }, markPrice > previousMarkPrice && /*#__PURE__*/React.createElement(ArrowUpOutlined, {\n    style: {\n      marginRight: 5\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 13\n    }\n  }), markPrice < previousMarkPrice && /*#__PURE__*/React.createElement(ArrowDownOutlined, {\n    style: {\n      marginRight: 5\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 13\n    }\n  }), formattedMarkPrice || '----'));\n}, (prevProps, nextProps) => isEqual(prevProps, nextProps, ['markPrice']));","map":{"version":3,"sources":["/home/dev/Code/dex-ui/src/components/Orderbook.jsx"],"names":["Col","Row","React","useRef","useEffect","useState","styled","css","useMarket","useOrderbook","useMarkPrice","isEqual","getDecimalCount","useInterval","FloatingElement","usePrevious","ArrowUpOutlined","ArrowDownOutlined","Title","div","SizeTitle","MarkPriceTitle","Line","props","Price","Orderbook","smallScreen","depth","onPrice","onSize","markPrice","orderbook","baseCurrency","quoteCurrency","currentOrderbookData","lastOrderbookData","orderbookData","setOrderbookData","current","JSON","stringify","bids","asks","sum","total","size","index","totalSize","reduce","bidsToDisplay","getCumulativeOrderbookSide","asksToDisplay","orders","backwards","cumulative","slice","price","i","cumulativeSize","push","sizePercent","Math","round","reverse","flex","height","overflow","borderTop","borderBottom","padding","color","fontSize","textAlign","paddingRight","paddingBottom","map","OrderbookRow","memo","side","onSizeClick","onPriceClick","element","market","classList","contains","add","id","setTimeout","remove","clearTimeout","formattedSize","minOrderSize","isNaN","Number","toFixed","formattedPrice","tickSize","marginBottom","prevProps","nextProps","MarkPriceComponent","previousMarkPrice","markPriceColor","formattedMarkPrice","marginRight"],"mappings":"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","sourcesContent":["import { Col, Row } from 'antd';\r\nimport React, { useRef, useEffect, useState } from 'react';\r\nimport styled, { css } from 'styled-components';\r\nimport { useMarket, useOrderbook, useMarkPrice } from '../utils/markets';\r\nimport { isEqual, getDecimalCount } from '../utils/utils';\r\nimport { useInterval } from '../utils/useInterval';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport usePrevious from '../utils/usePrevious';\r\nimport { ArrowUpOutlined, ArrowDownOutlined } from '@ant-design/icons';\r\n\r\nconst Title = styled.div`\r\n  color: rgba(255, 255, 255, 1);\r\n`;\r\n\r\nconst SizeTitle = styled(Row)`\r\n  padding: 16px 0 12px;\r\n  color: #434a59;\r\n`;\r\n\r\nconst MarkPriceTitle = styled(Row)`\r\n  padding: 15px 0 12px;\r\n  font-weight: 700;\r\n`;\r\n\r\nconst Line = styled.div`\r\n  text-align: right;\r\n  float: right;\r\n  height: 100%;\r\n  ${(props) =>\r\n    props['data-width'] &&\r\n    css`\r\n      width: ${props['data-width']};\r\n    `}\r\n  ${(props) =>\r\n    props['data-bgcolor'] &&\r\n    css`\r\n      background-color: ${props['data-bgcolor']};\r\n    `}\r\n`;\r\n\r\nconst Price = styled.div`\r\n  position: absolute;\r\n  right: 5px;\r\n  color: white;\r\n`;\r\n\r\nexport default function Orderbook({ smallScreen, depth = 7, onPrice, onSize }) {\r\n  const markPrice = useMarkPrice();\r\n  const [orderbook] = useOrderbook();\r\n  const { baseCurrency, quoteCurrency } = useMarket();\r\n\r\n  const currentOrderbookData = useRef(null);\r\n  const lastOrderbookData = useRef(null);\r\n\r\n  const [orderbookData, setOrderbookData] = useState(null);\r\n\r\n  useInterval(() => {\r\n    if (\r\n      !currentOrderbookData.current ||\r\n      JSON.stringify(currentOrderbookData.current) !==\r\n        JSON.stringify(lastOrderbookData.current)\r\n    ) {\r\n      let bids = orderbook?.bids || [];\r\n      let asks = orderbook?.asks || [];\r\n\r\n      let sum = (total, [, size], index) =>\r\n        index < depth ? total + size : total;\r\n      let totalSize = bids.reduce(sum, 0) + asks.reduce(sum, 0);\r\n\r\n      let bidsToDisplay = getCumulativeOrderbookSide(bids, totalSize, false);\r\n      let asksToDisplay = getCumulativeOrderbookSide(asks, totalSize, true);\r\n\r\n      currentOrderbookData.current = {\r\n        bids: orderbook?.bids,\r\n        asks: orderbook?.asks,\r\n      };\r\n\r\n      setOrderbookData({ bids: bidsToDisplay, asks: asksToDisplay });\r\n    }\r\n  }, 250);\r\n\r\n  useEffect(() => {\r\n    lastOrderbookData.current = {\r\n      bids: orderbook?.bids,\r\n      asks: orderbook?.asks,\r\n    };\r\n  }, [orderbook]);\r\n\r\n  function getCumulativeOrderbookSide(orders, totalSize, backwards = false) {\r\n    let cumulative = orders\r\n      .slice(0, depth)\r\n      .reduce((cumulative, [price, size], i) => {\r\n        const cumulativeSize = (cumulative[i - 1]?.cumulativeSize || 0) + size;\r\n        cumulative.push({\r\n          price,\r\n          size,\r\n          cumulativeSize,\r\n          sizePercent: Math.round((cumulativeSize / (totalSize || 1)) * 100),\r\n        });\r\n        return cumulative;\r\n      }, []);\r\n    if (backwards) {\r\n      cumulative = cumulative.reverse();\r\n    }\r\n    return cumulative;\r\n  }\r\n\r\n  return (\r\n    <FloatingElement\r\n      style={{\r\n        ...(smallScreen\r\n          ? { flex: 1 }\r\n          : { height: '500px', overflow: 'hidden' }),\r\n        height: 540,\r\n      }}\r\n    >\r\n      <Title\r\n        style={{\r\n          borderTop: '1px solid #1C274F',\r\n          borderBottom: '1px solid #1C274F',\r\n          padding: '12px 0 12px 16px',\r\n          color: 'rgba(241, 241, 242, 0.75)',\r\n          fontSize: 14,\r\n        }}\r\n      >\r\n        Order book\r\n      </Title>\r\n      <SizeTitle>\r\n        <Col\r\n          span={12}\r\n          style={{\r\n            textAlign: 'right',\r\n            color: 'rgba(241, 241, 242, 0.5)',\r\n            fontSize: 12,\r\n          }}\r\n        >\r\n          Size ({baseCurrency})\r\n        </Col>\r\n        <Col\r\n          span={12}\r\n          style={{\r\n            textAlign: 'right',\r\n            paddingRight: 20,\r\n            color: 'rgba(241, 241, 242, 0.5)',\r\n            fontSize: 12,\r\n          }}\r\n        >\r\n          Price ({quoteCurrency})\r\n        </Col>\r\n      </SizeTitle>\r\n      <div style={{ paddingBottom: 16 }}>\r\n        {orderbookData?.asks.map(({ price, size, sizePercent }) => (\r\n          <OrderbookRow\r\n            key={price + ''}\r\n            price={price}\r\n            size={size}\r\n            side={'sell'}\r\n            sizePercent={sizePercent}\r\n            onPriceClick={() => onPrice(price)}\r\n            onSizeClick={() => onSize(size)}\r\n          />\r\n        ))}\r\n      </div>\r\n      <MarkPriceComponent markPrice={markPrice} />\r\n      <SizeTitle>\r\n        <Col\r\n          span={12}\r\n          style={{\r\n            textAlign: 'right',\r\n            color: 'rgba(241, 241, 242, 0.5)',\r\n            fontSize: 12,\r\n          }}\r\n        >\r\n          Size ({baseCurrency})\r\n        </Col>\r\n        <Col\r\n          span={12}\r\n          style={{\r\n            textAlign: 'right',\r\n            paddingRight: 20,\r\n            color: 'rgba(241, 241, 242, 0.5)',\r\n            fontSize: 12,\r\n          }}\r\n        >\r\n          Price ({quoteCurrency})\r\n        </Col>\r\n      </SizeTitle>\r\n      {orderbookData?.bids.map(({ price, size, sizePercent }) => (\r\n        <OrderbookRow\r\n          key={price + ''}\r\n          price={price}\r\n          size={size}\r\n          side={'buy'}\r\n          sizePercent={sizePercent}\r\n          onPriceClick={() => onPrice(price)}\r\n          onSizeClick={() => onSize(size)}\r\n        />\r\n      ))}\r\n    </FloatingElement>\r\n  );\r\n}\r\n\r\nconst OrderbookRow = React.memo(\r\n  ({ side, price, size, sizePercent, onSizeClick, onPriceClick }) => {\r\n    const element = useRef();\r\n\r\n    const { market } = useMarket();\r\n\r\n    useEffect(() => {\r\n      // eslint-disable-next-line\r\n      !element.current?.classList.contains('flash') &&\r\n        element.current?.classList.add('flash');\r\n      const id = setTimeout(\r\n        () =>\r\n          element.current?.classList.contains('flash') &&\r\n          element.current?.classList.remove('flash'),\r\n        250,\r\n      );\r\n      return () => clearTimeout(id);\r\n    }, [price, size]);\r\n\r\n    let formattedSize =\r\n      market?.minOrderSize && !isNaN(size)\r\n        ? Number(size).toFixed(getDecimalCount(market.minOrderSize) + 1)\r\n        : size;\r\n\r\n    let formattedPrice =\r\n      market?.tickSize && !isNaN(price)\r\n        ? Number(price).toFixed(getDecimalCount(market.tickSize) + 1)\r\n        : price;\r\n\r\n    return (\r\n      <Row\r\n        ref={element}\r\n        style={{ marginBottom: 3, fontSize: 12 }}\r\n        onClick={onSizeClick}\r\n      >\r\n        <Col span={12} style={{ textAlign: 'right' }}>\r\n          {formattedSize}\r\n        </Col>\r\n        <Col span={12} style={{ textAlign: 'right' }}>\r\n          <Line\r\n            data-width={sizePercent + '%'}\r\n            data-bgcolor={\r\n              side === 'buy'\r\n                ? 'rgba(65, 199, 122, 0.6)'\r\n                : 'rgba(242, 60, 105, 0.6)'\r\n            }\r\n          />\r\n          <Price onClick={onPriceClick}>{formattedPrice}</Price>\r\n        </Col>\r\n      </Row>\r\n    );\r\n  },\r\n  (prevProps, nextProps) =>\r\n    isEqual(prevProps, nextProps, ['price', 'size', 'sizePercent']),\r\n);\r\n\r\nconst MarkPriceComponent = React.memo(\r\n  ({ markPrice }) => {\r\n    const { market } = useMarket();\r\n    const previousMarkPrice = usePrevious(markPrice);\r\n\r\n    let markPriceColor =\r\n      markPrice > previousMarkPrice\r\n        ? '#41C77A'\r\n        : markPrice < previousMarkPrice\r\n        ? '#F23B69'\r\n        : 'white';\r\n\r\n    let formattedMarkPrice =\r\n      markPrice &&\r\n      market?.tickSize &&\r\n      markPrice.toFixed(getDecimalCount(market.tickSize));\r\n\r\n    return (\r\n      <MarkPriceTitle\r\n        justify=\"center\"\r\n        style={{\r\n          borderTop: '1px solid #1C274F',\r\n          borderBottom: '1px solid #1C274F',\r\n          fontSize: 16,\r\n        }}\r\n      >\r\n        <Col style={{ color: markPriceColor }}>\r\n          {markPrice > previousMarkPrice && (\r\n            <ArrowUpOutlined style={{ marginRight: 5 }} />\r\n          )}\r\n          {markPrice < previousMarkPrice && (\r\n            <ArrowDownOutlined style={{ marginRight: 5 }} />\r\n          )}\r\n          {formattedMarkPrice || '----'}\r\n        </Col>\r\n      </MarkPriceTitle>\r\n    );\r\n  },\r\n  (prevProps, nextProps) => isEqual(prevProps, nextProps, ['markPrice']),\r\n);\r\n"]},"metadata":{},"sourceType":"module"}