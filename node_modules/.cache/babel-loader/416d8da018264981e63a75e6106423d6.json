{"ast":null,"code":"var _jsxFileName = \"/home/dev/Code/dex-ui/src/components/CustomMarketDialog.jsx\";\nimport React, { useEffect, useState } from 'react';\nimport { Col, Input, Modal, Row, Typography } from 'antd';\nimport { notify } from '../utils/notifications';\nimport { isValidPublicKey } from '../utils/utils';\nimport { PublicKey } from '@solana/web3.js';\nimport { Market, MARKETS, TOKEN_MINTS } from '@project-serum/serum';\nimport { useAccountInfo, useConnection } from '../utils/connection';\nimport { LoadingOutlined } from '@ant-design/icons';\nconst {\n  Text\n} = Typography;\nexport default function CustomMarketDialog({\n  visible,\n  onAddCustomMarket,\n  onClose\n}) {\n  var _TOKEN_MINTS$find, _TOKEN_MINTS$find2;\n\n  const connection = useConnection();\n  const [marketId, setMarketId] = useState('');\n  const [marketLabel, setMarketLabel] = useState('');\n  const [baseLabel, setBaseLabel] = useState('');\n  const [quoteLabel, setQuoteLabel] = useState('');\n  const [market, setMarket] = useState(null);\n  const [loadingMarket, setLoadingMarket] = useState(false);\n  const wellFormedMarketId = isValidPublicKey(marketId);\n  const [marketAccountInfo] = useAccountInfo(wellFormedMarketId ? new PublicKey(marketId) : null);\n  const programId = marketAccountInfo ? marketAccountInfo.owner.toBase58() : MARKETS.find(({\n    deprecated\n  }) => !deprecated).programId.toBase58();\n  useEffect(() => {\n    if (!wellFormedMarketId || !programId) {\n      resetLabels();\n      return;\n    }\n\n    setLoadingMarket(true);\n    Market.load(connection, new PublicKey(marketId), {}, new PublicKey(programId)).then(market => {\n      setMarket(market);\n    }).catch(() => {\n      resetLabels();\n      setMarket(null);\n    }).finally(() => setLoadingMarket(false)); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [connection, marketId, programId]);\n\n  const resetLabels = () => {\n    setMarketLabel(null);\n    setBaseLabel(null);\n    setQuoteLabel(null);\n  };\n\n  const knownMarket = MARKETS.find(m => m.address.toBase58() === marketId && m.programId.toBase58() === programId);\n  const knownProgram = MARKETS.find(m => m.programId.toBase58() === programId);\n  const knownBaseCurrency = (market === null || market === void 0 ? void 0 : market.baseMintAddress) && ((_TOKEN_MINTS$find = TOKEN_MINTS.find(token => token.address.equals(market.baseMintAddress))) === null || _TOKEN_MINTS$find === void 0 ? void 0 : _TOKEN_MINTS$find.name);\n  const knownQuoteCurrency = (market === null || market === void 0 ? void 0 : market.quoteMintAddress) && ((_TOKEN_MINTS$find2 = TOKEN_MINTS.find(token => token.address.equals(market.quoteMintAddress))) === null || _TOKEN_MINTS$find2 === void 0 ? void 0 : _TOKEN_MINTS$find2.name);\n  const canSubmit = !loadingMarket && !!market && market.publicKey.toBase58() === marketId && marketId && programId && marketLabel && (knownBaseCurrency || baseLabel) && (knownQuoteCurrency || quoteLabel) && wellFormedMarketId;\n\n  const onSubmit = () => {\n    if (!canSubmit) {\n      notify({\n        message: 'Please fill in all fields with valid values',\n        type: 'error'\n      });\n      return;\n    }\n\n    let params = {\n      address: marketId,\n      programId,\n      name: marketLabel\n    };\n\n    if (!knownBaseCurrency) {\n      params.baseLabel = baseLabel;\n    }\n\n    if (!knownQuoteCurrency) {\n      params.quoteLabel = quoteLabel;\n    }\n\n    onAddCustomMarket(params);\n    onDoClose();\n  };\n\n  const onDoClose = () => {\n    resetLabels();\n    setMarket(null);\n    setMarketId(null);\n    onClose();\n  };\n\n  return /*#__PURE__*/React.createElement(Modal, {\n    title: 'Add custom market',\n    visible: visible,\n    onOk: onSubmit,\n    okText: market && knownProgram && knownProgram.deprecated ? 'Refused to add' : 'Add',\n    onCancel: onDoClose,\n    okButtonProps: {\n      disabled: !canSubmit || market && knownProgram && knownProgram.deprecated\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }\n  }, wellFormedMarketId ? /*#__PURE__*/React.createElement(React.Fragment, null, !market && !loadingMarket && /*#__PURE__*/React.createElement(Row, {\n    style: {\n      marginBottom: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Text, {\n    type: \"danger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 17\n    }\n  }, \"Not a valid market\")), market && knownMarket && /*#__PURE__*/React.createElement(Row, {\n    style: {\n      marginBottom: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Text, {\n    type: \"warning\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 17\n    }\n  }, \"Market known: \", knownMarket.name)), market && !knownProgram && /*#__PURE__*/React.createElement(Row, {\n    style: {\n      marginBottom: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Text, {\n    type: \"danger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 17\n    }\n  }, \"Warning: unknown DEX program\")), market && knownProgram && knownProgram.deprecated && /*#__PURE__*/React.createElement(Row, {\n    style: {\n      marginBottom: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Text, {\n    type: \"warning\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 17\n    }\n  }, \"Warning: deprecated DEX program\"))) : /*#__PURE__*/React.createElement(React.Fragment, null, marketId && !wellFormedMarketId && /*#__PURE__*/React.createElement(Row, {\n    style: {\n      marginBottom: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Text, {\n    type: \"danger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 17\n    }\n  }, \"Invalid market ID\"))), /*#__PURE__*/React.createElement(Row, {\n    style: {\n      marginBottom: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 24,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    placeholder: \"Market Id\",\n    value: marketId,\n    onChange: e => setMarketId(e.target.value),\n    suffix: loadingMarket ? /*#__PURE__*/React.createElement(LoadingOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 39\n      }\n    }) : null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(Row, {\n    style: {\n      marginBottom: 8,\n      marginTop: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 24,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    placeholder: \"Market Label\",\n    disabled: !market,\n    value: marketLabel,\n    onChange: e => setMarketLabel(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(Row, {\n    gutter: [8],\n    style: {\n      marginBottom: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    placeholder: \"Base label\",\n    disabled: !market || knownBaseCurrency,\n    value: knownBaseCurrency || baseLabel,\n    onChange: e => setBaseLabel(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 13\n    }\n  }), market && !knownBaseCurrency && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      marginTop: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Text, {\n    type: \"warning\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 17\n    }\n  }, \"Warning: unknown token\"))), /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    placeholder: \"Quote label\",\n    disabled: !market || knownQuoteCurrency,\n    value: knownQuoteCurrency || quoteLabel,\n    onChange: e => setQuoteLabel(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 13\n    }\n  }), market && !knownQuoteCurrency && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      marginTop: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Text, {\n    type: \"warning\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 17\n    }\n  }, \"Warning: unknown token\"))))));\n}","map":{"version":3,"sources":["/home/dev/Code/dex-ui/src/components/CustomMarketDialog.jsx"],"names":["React","useEffect","useState","Col","Input","Modal","Row","Typography","notify","isValidPublicKey","PublicKey","Market","MARKETS","TOKEN_MINTS","useAccountInfo","useConnection","LoadingOutlined","Text","CustomMarketDialog","visible","onAddCustomMarket","onClose","connection","marketId","setMarketId","marketLabel","setMarketLabel","baseLabel","setBaseLabel","quoteLabel","setQuoteLabel","market","setMarket","loadingMarket","setLoadingMarket","wellFormedMarketId","marketAccountInfo","programId","owner","toBase58","find","deprecated","resetLabels","load","then","catch","finally","knownMarket","m","address","knownProgram","knownBaseCurrency","baseMintAddress","token","equals","name","knownQuoteCurrency","quoteMintAddress","canSubmit","publicKey","onSubmit","message","type","params","onDoClose","disabled","marginBottom","e","target","value","marginTop"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SAASC,GAAT,EAAcC,KAAd,EAAqBC,KAArB,EAA4BC,GAA5B,EAAiCC,UAAjC,QAAmD,MAAnD;AACA,SAASC,MAAT,QAAuB,wBAAvB;AACA,SAASC,gBAAT,QAAiC,gBAAjC;AACA,SAASC,SAAT,QAA0B,iBAA1B;AACA,SAASC,MAAT,EAAiBC,OAAjB,EAA0BC,WAA1B,QAA6C,sBAA7C;AACA,SAASC,cAAT,EAAyBC,aAAzB,QAA8C,qBAA9C;AACA,SAASC,eAAT,QAAgC,mBAAhC;AAEA,MAAM;AAAEC,EAAAA;AAAF,IAAWV,UAAjB;AAEA,eAAe,SAASW,kBAAT,CAA4B;AACzCC,EAAAA,OADyC;AAEzCC,EAAAA,iBAFyC;AAGzCC,EAAAA;AAHyC,CAA5B,EAIZ;AAAA;;AACD,QAAMC,UAAU,GAAGP,aAAa,EAAhC;AAEA,QAAM,CAACQ,QAAD,EAAWC,WAAX,IAA0BtB,QAAQ,CAAC,EAAD,CAAxC;AAEA,QAAM,CAACuB,WAAD,EAAcC,cAAd,IAAgCxB,QAAQ,CAAC,EAAD,CAA9C;AACA,QAAM,CAACyB,SAAD,EAAYC,YAAZ,IAA4B1B,QAAQ,CAAC,EAAD,CAA1C;AACA,QAAM,CAAC2B,UAAD,EAAaC,aAAb,IAA8B5B,QAAQ,CAAC,EAAD,CAA5C;AAEA,QAAM,CAAC6B,MAAD,EAASC,SAAT,IAAsB9B,QAAQ,CAAC,IAAD,CAApC;AACA,QAAM,CAAC+B,aAAD,EAAgBC,gBAAhB,IAAoChC,QAAQ,CAAC,KAAD,CAAlD;AAEA,QAAMiC,kBAAkB,GAAG1B,gBAAgB,CAACc,QAAD,CAA3C;AAEA,QAAM,CAACa,iBAAD,IAAsBtB,cAAc,CACxCqB,kBAAkB,GAAG,IAAIzB,SAAJ,CAAca,QAAd,CAAH,GAA6B,IADP,CAA1C;AAGA,QAAMc,SAAS,GAAGD,iBAAiB,GAC/BA,iBAAiB,CAACE,KAAlB,CAAwBC,QAAxB,EAD+B,GAE/B3B,OAAO,CAAC4B,IAAR,CAAa,CAAC;AAAEC,IAAAA;AAAF,GAAD,KAAoB,CAACA,UAAlC,EAA8CJ,SAA9C,CAAwDE,QAAxD,EAFJ;AAIAtC,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,CAACkC,kBAAD,IAAuB,CAACE,SAA5B,EAAuC;AACrCK,MAAAA,WAAW;AACX;AACD;;AACDR,IAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACAvB,IAAAA,MAAM,CAACgC,IAAP,CACErB,UADF,EAEE,IAAIZ,SAAJ,CAAca,QAAd,CAFF,EAGE,EAHF,EAIE,IAAIb,SAAJ,CAAc2B,SAAd,CAJF,EAMGO,IANH,CAMSb,MAAD,IAAY;AAChBC,MAAAA,SAAS,CAACD,MAAD,CAAT;AACD,KARH,EASGc,KATH,CASS,MAAM;AACXH,MAAAA,WAAW;AACXV,MAAAA,SAAS,CAAC,IAAD,CAAT;AACD,KAZH,EAaGc,OAbH,CAaW,MAAMZ,gBAAgB,CAAC,KAAD,CAbjC,EANc,CAoBd;AACD,GArBQ,EAqBN,CAACZ,UAAD,EAAaC,QAAb,EAAuBc,SAAvB,CArBM,CAAT;;AAuBA,QAAMK,WAAW,GAAG,MAAM;AACxBhB,IAAAA,cAAc,CAAC,IAAD,CAAd;AACAE,IAAAA,YAAY,CAAC,IAAD,CAAZ;AACAE,IAAAA,aAAa,CAAC,IAAD,CAAb;AACD,GAJD;;AAMA,QAAMiB,WAAW,GAAGnC,OAAO,CAAC4B,IAAR,CACjBQ,CAAD,IACEA,CAAC,CAACC,OAAF,CAAUV,QAAV,OAAyBhB,QAAzB,IAAqCyB,CAAC,CAACX,SAAF,CAAYE,QAAZ,OAA2BF,SAFhD,CAApB;AAIA,QAAMa,YAAY,GAAGtC,OAAO,CAAC4B,IAAR,CAClBQ,CAAD,IAAOA,CAAC,CAACX,SAAF,CAAYE,QAAZ,OAA2BF,SADf,CAArB;AAGA,QAAMc,iBAAiB,GACrB,CAAApB,MAAM,SAAN,IAAAA,MAAM,WAAN,YAAAA,MAAM,CAAEqB,eAAR,2BACAvC,WAAW,CAAC2B,IAAZ,CAAkBa,KAAD,IAAWA,KAAK,CAACJ,OAAN,CAAcK,MAAd,CAAqBvB,MAAM,CAACqB,eAA5B,CAA5B,CADA,sDACA,kBACIG,IAFJ,CADF;AAKA,QAAMC,kBAAkB,GACtB,CAAAzB,MAAM,SAAN,IAAAA,MAAM,WAAN,YAAAA,MAAM,CAAE0B,gBAAR,4BACA5C,WAAW,CAAC2B,IAAZ,CAAkBa,KAAD,IAAWA,KAAK,CAACJ,OAAN,CAAcK,MAAd,CAAqBvB,MAAM,CAAC0B,gBAA5B,CAA5B,CADA,uDACA,mBACIF,IAFJ,CADF;AAKA,QAAMG,SAAS,GACb,CAACzB,aAAD,IACA,CAAC,CAACF,MADF,IAEAA,MAAM,CAAC4B,SAAP,CAAiBpB,QAAjB,OAAgChB,QAFhC,IAGAA,QAHA,IAIAc,SAJA,IAKAZ,WALA,KAMC0B,iBAAiB,IAAIxB,SANtB,MAOC6B,kBAAkB,IAAI3B,UAPvB,KAQAM,kBATF;;AAWA,QAAMyB,QAAQ,GAAG,MAAM;AACrB,QAAI,CAACF,SAAL,EAAgB;AACdlD,MAAAA,MAAM,CAAC;AACLqD,QAAAA,OAAO,EAAE,6CADJ;AAELC,QAAAA,IAAI,EAAE;AAFD,OAAD,CAAN;AAIA;AACD;;AAED,QAAIC,MAAM,GAAG;AACXd,MAAAA,OAAO,EAAE1B,QADE;AAEXc,MAAAA,SAFW;AAGXkB,MAAAA,IAAI,EAAE9B;AAHK,KAAb;;AAKA,QAAI,CAAC0B,iBAAL,EAAwB;AACtBY,MAAAA,MAAM,CAACpC,SAAP,GAAmBA,SAAnB;AACD;;AACD,QAAI,CAAC6B,kBAAL,EAAyB;AACvBO,MAAAA,MAAM,CAAClC,UAAP,GAAoBA,UAApB;AACD;;AACDT,IAAAA,iBAAiB,CAAC2C,MAAD,CAAjB;AACAC,IAAAA,SAAS;AACV,GAtBD;;AAwBA,QAAMA,SAAS,GAAG,MAAM;AACtBtB,IAAAA,WAAW;AACXV,IAAAA,SAAS,CAAC,IAAD,CAAT;AACAR,IAAAA,WAAW,CAAC,IAAD,CAAX;AACAH,IAAAA,OAAO;AACR,GALD;;AAOA,sBACE,oBAAC,KAAD;AACE,IAAA,KAAK,EAAE,mBADT;AAEE,IAAA,OAAO,EAAEF,OAFX;AAGE,IAAA,IAAI,EAAEyC,QAHR;AAIE,IAAA,MAAM,EACJ7B,MAAM,IAAImB,YAAV,IAA0BA,YAAY,CAACT,UAAvC,GACI,gBADJ,GAEI,KAPR;AASE,IAAA,QAAQ,EAAEuB,SATZ;AAUE,IAAA,aAAa,EAAE;AACbC,MAAAA,QAAQ,EACN,CAACP,SAAD,IAAe3B,MAAM,IAAImB,YAAV,IAA0BA,YAAY,CAACT;AAF3C,KAVjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAeE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGN,kBAAkB,gBACjB,0CACG,CAACJ,MAAD,IAAW,CAACE,aAAZ,iBACC,oBAAC,GAAD;AAAK,IAAA,KAAK,EAAE;AAAEiC,MAAAA,YAAY,EAAE;AAAhB,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAC,QAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BADF,CAFJ,EAMGnC,MAAM,IAAIgB,WAAV,iBACC,oBAAC,GAAD;AAAK,IAAA,KAAK,EAAE;AAAEmB,MAAAA,YAAY,EAAE;AAAhB,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAC,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAAoCnB,WAAW,CAACQ,IAAhD,CADF,CAPJ,EAWGxB,MAAM,IAAI,CAACmB,YAAX,iBACC,oBAAC,GAAD;AAAK,IAAA,KAAK,EAAE;AAAEgB,MAAAA,YAAY,EAAE;AAAhB,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAC,QAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCADF,CAZJ,EAgBGnC,MAAM,IAAImB,YAAV,IAA0BA,YAAY,CAACT,UAAvC,iBACC,oBAAC,GAAD;AAAK,IAAA,KAAK,EAAE;AAAEyB,MAAAA,YAAY,EAAE;AAAhB,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAC,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uCADF,CAjBJ,CADiB,gBAwBjB,0CACG3C,QAAQ,IAAI,CAACY,kBAAb,iBACC,oBAAC,GAAD;AAAK,IAAA,KAAK,EAAE;AAAE+B,MAAAA,YAAY,EAAE;AAAhB,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAC,QAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBADF,CAFJ,CAzBJ,eAiCE,oBAAC,GAAD;AAAK,IAAA,KAAK,EAAE;AAAEA,MAAAA,YAAY,EAAE;AAAhB,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,GAAD;AAAK,IAAA,IAAI,EAAE,EAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,KAAD;AACE,IAAA,WAAW,EAAC,WADd;AAEE,IAAA,KAAK,EAAE3C,QAFT;AAGE,IAAA,QAAQ,EAAG4C,CAAD,IAAO3C,WAAW,CAAC2C,CAAC,CAACC,MAAF,CAASC,KAAV,CAH9B;AAIE,IAAA,MAAM,EAAEpC,aAAa,gBAAG,oBAAC,eAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAH,GAAyB,IAJhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF,CAjCF,eA4CE,oBAAC,GAAD;AAAK,IAAA,KAAK,EAAE;AAAEiC,MAAAA,YAAY,EAAE,CAAhB;AAAmBI,MAAAA,SAAS,EAAE;AAA9B,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,GAAD;AAAK,IAAA,IAAI,EAAE,EAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,KAAD;AACE,IAAA,WAAW,EAAC,cADd;AAEE,IAAA,QAAQ,EAAE,CAACvC,MAFb;AAGE,IAAA,KAAK,EAAEN,WAHT;AAIE,IAAA,QAAQ,EAAG0C,CAAD,IAAOzC,cAAc,CAACyC,CAAC,CAACC,MAAF,CAASC,KAAV,CAJjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF,CA5CF,eAsDE,oBAAC,GAAD;AAAK,IAAA,MAAM,EAAE,CAAC,CAAD,CAAb;AAAkB,IAAA,KAAK,EAAE;AAAEH,MAAAA,YAAY,EAAE;AAAhB,KAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,GAAD;AAAK,IAAA,IAAI,EAAE,EAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,KAAD;AACE,IAAA,WAAW,EAAC,YADd;AAEE,IAAA,QAAQ,EAAE,CAACnC,MAAD,IAAWoB,iBAFvB;AAGE,IAAA,KAAK,EAAEA,iBAAiB,IAAIxB,SAH9B;AAIE,IAAA,QAAQ,EAAGwC,CAAD,IAAOvC,YAAY,CAACuC,CAAC,CAACC,MAAF,CAASC,KAAV,CAJ/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAOGtC,MAAM,IAAI,CAACoB,iBAAX,iBACC;AAAK,IAAA,KAAK,EAAE;AAAEmB,MAAAA,SAAS,EAAE;AAAb,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAC,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BADF,CARJ,CADF,eAcE,oBAAC,GAAD;AAAK,IAAA,IAAI,EAAE,EAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,KAAD;AACE,IAAA,WAAW,EAAC,aADd;AAEE,IAAA,QAAQ,EAAE,CAACvC,MAAD,IAAWyB,kBAFvB;AAGE,IAAA,KAAK,EAAEA,kBAAkB,IAAI3B,UAH/B;AAIE,IAAA,QAAQ,EAAGsC,CAAD,IAAOrC,aAAa,CAACqC,CAAC,CAACC,MAAF,CAASC,KAAV,CAJhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAOGtC,MAAM,IAAI,CAACyB,kBAAX,iBACC;AAAK,IAAA,KAAK,EAAE;AAAEc,MAAAA,SAAS,EAAE;AAAb,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAC,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BADF,CARJ,CAdF,CAtDF,CAfF,CADF;AAqGD","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { Col, Input, Modal, Row, Typography } from 'antd';\r\nimport { notify } from '../utils/notifications';\r\nimport { isValidPublicKey } from '../utils/utils';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport { Market, MARKETS, TOKEN_MINTS } from '@project-serum/serum';\r\nimport { useAccountInfo, useConnection } from '../utils/connection';\r\nimport { LoadingOutlined } from '@ant-design/icons';\r\n\r\nconst { Text } = Typography;\r\n\r\nexport default function CustomMarketDialog({\r\n  visible,\r\n  onAddCustomMarket,\r\n  onClose,\r\n}) {\r\n  const connection = useConnection();\r\n\r\n  const [marketId, setMarketId] = useState('');\r\n\r\n  const [marketLabel, setMarketLabel] = useState('');\r\n  const [baseLabel, setBaseLabel] = useState('');\r\n  const [quoteLabel, setQuoteLabel] = useState('');\r\n\r\n  const [market, setMarket] = useState(null);\r\n  const [loadingMarket, setLoadingMarket] = useState(false);\r\n\r\n  const wellFormedMarketId = isValidPublicKey(marketId);\r\n\r\n  const [marketAccountInfo] = useAccountInfo(\r\n    wellFormedMarketId ? new PublicKey(marketId) : null,\r\n  );\r\n  const programId = marketAccountInfo\r\n    ? marketAccountInfo.owner.toBase58()\r\n    : MARKETS.find(({ deprecated }) => !deprecated).programId.toBase58();\r\n\r\n  useEffect(() => {\r\n    if (!wellFormedMarketId || !programId) {\r\n      resetLabels();\r\n      return;\r\n    }\r\n    setLoadingMarket(true);\r\n    Market.load(\r\n      connection,\r\n      new PublicKey(marketId),\r\n      {},\r\n      new PublicKey(programId),\r\n    )\r\n      .then((market) => {\r\n        setMarket(market);\r\n      })\r\n      .catch(() => {\r\n        resetLabels();\r\n        setMarket(null);\r\n      })\r\n      .finally(() => setLoadingMarket(false));\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [connection, marketId, programId]);\r\n\r\n  const resetLabels = () => {\r\n    setMarketLabel(null);\r\n    setBaseLabel(null);\r\n    setQuoteLabel(null);\r\n  };\r\n\r\n  const knownMarket = MARKETS.find(\r\n    (m) =>\r\n      m.address.toBase58() === marketId && m.programId.toBase58() === programId,\r\n  );\r\n  const knownProgram = MARKETS.find(\r\n    (m) => m.programId.toBase58() === programId,\r\n  );\r\n  const knownBaseCurrency =\r\n    market?.baseMintAddress &&\r\n    TOKEN_MINTS.find((token) => token.address.equals(market.baseMintAddress))\r\n      ?.name;\r\n\r\n  const knownQuoteCurrency =\r\n    market?.quoteMintAddress &&\r\n    TOKEN_MINTS.find((token) => token.address.equals(market.quoteMintAddress))\r\n      ?.name;\r\n\r\n  const canSubmit =\r\n    !loadingMarket &&\r\n    !!market &&\r\n    market.publicKey.toBase58() === marketId &&\r\n    marketId &&\r\n    programId &&\r\n    marketLabel &&\r\n    (knownBaseCurrency || baseLabel) &&\r\n    (knownQuoteCurrency || quoteLabel) &&\r\n    wellFormedMarketId;\r\n\r\n  const onSubmit = () => {\r\n    if (!canSubmit) {\r\n      notify({\r\n        message: 'Please fill in all fields with valid values',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n\r\n    let params = {\r\n      address: marketId,\r\n      programId,\r\n      name: marketLabel,\r\n    };\r\n    if (!knownBaseCurrency) {\r\n      params.baseLabel = baseLabel;\r\n    }\r\n    if (!knownQuoteCurrency) {\r\n      params.quoteLabel = quoteLabel;\r\n    }\r\n    onAddCustomMarket(params);\r\n    onDoClose();\r\n  };\r\n\r\n  const onDoClose = () => {\r\n    resetLabels();\r\n    setMarket(null);\r\n    setMarketId(null);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title={'Add custom market'}\r\n      visible={visible}\r\n      onOk={onSubmit}\r\n      okText={\r\n        market && knownProgram && knownProgram.deprecated\r\n          ? 'Refused to add'\r\n          : 'Add'\r\n      }\r\n      onCancel={onDoClose}\r\n      okButtonProps={{\r\n        disabled:\r\n          !canSubmit || (market && knownProgram && knownProgram.deprecated),\r\n      }}\r\n    >\r\n      <div>\r\n        {wellFormedMarketId ? (\r\n          <>\r\n            {!market && !loadingMarket && (\r\n              <Row style={{ marginBottom: 8 }}>\r\n                <Text type=\"danger\">Not a valid market</Text>\r\n              </Row>\r\n            )}\r\n            {market && knownMarket && (\r\n              <Row style={{ marginBottom: 8 }}>\r\n                <Text type=\"warning\">Market known: {knownMarket.name}</Text>\r\n              </Row>\r\n            )}\r\n            {market && !knownProgram && (\r\n              <Row style={{ marginBottom: 8 }}>\r\n                <Text type=\"danger\">Warning: unknown DEX program</Text>\r\n              </Row>\r\n            )}\r\n            {market && knownProgram && knownProgram.deprecated && (\r\n              <Row style={{ marginBottom: 8 }}>\r\n                <Text type=\"warning\">Warning: deprecated DEX program</Text>\r\n              </Row>\r\n            )}\r\n          </>\r\n        ) : (\r\n          <>\r\n            {marketId && !wellFormedMarketId && (\r\n              <Row style={{ marginBottom: 8 }}>\r\n                <Text type=\"danger\">Invalid market ID</Text>\r\n              </Row>\r\n            )}\r\n          </>\r\n        )}\r\n        <Row style={{ marginBottom: 8 }}>\r\n          <Col span={24}>\r\n            <Input\r\n              placeholder=\"Market Id\"\r\n              value={marketId}\r\n              onChange={(e) => setMarketId(e.target.value)}\r\n              suffix={loadingMarket ? <LoadingOutlined /> : null}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        <Row style={{ marginBottom: 8, marginTop: 8 }}>\r\n          <Col span={24}>\r\n            <Input\r\n              placeholder=\"Market Label\"\r\n              disabled={!market}\r\n              value={marketLabel}\r\n              onChange={(e) => setMarketLabel(e.target.value)}\r\n            />\r\n          </Col>\r\n        </Row>\r\n        <Row gutter={[8]} style={{ marginBottom: 8 }}>\r\n          <Col span={12}>\r\n            <Input\r\n              placeholder=\"Base label\"\r\n              disabled={!market || knownBaseCurrency}\r\n              value={knownBaseCurrency || baseLabel}\r\n              onChange={(e) => setBaseLabel(e.target.value)}\r\n            />\r\n            {market && !knownBaseCurrency && (\r\n              <div style={{ marginTop: 8 }}>\r\n                <Text type=\"warning\">Warning: unknown token</Text>\r\n              </div>\r\n            )}\r\n          </Col>\r\n          <Col span={12}>\r\n            <Input\r\n              placeholder=\"Quote label\"\r\n              disabled={!market || knownQuoteCurrency}\r\n              value={knownQuoteCurrency || quoteLabel}\r\n              onChange={(e) => setQuoteLabel(e.target.value)}\r\n            />\r\n            {market && !knownQuoteCurrency && (\r\n              <div style={{ marginTop: 8 }}>\r\n                <Text type=\"warning\">Warning: unknown token</Text>\r\n              </div>\r\n            )}\r\n          </Col>\r\n        </Row>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}